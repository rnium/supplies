<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <t t-name="supplies.dashboard" >
        <Layout display="display" className="'o_dashboard'">
            <div class="container py-2">
                <div class="row">
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col m-0 p-0">
                                <div class="border m-2 px-4 py-2 bg-white rounded shadow-sm">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h2 class="text-primary fw-bold m-0">Supplier Stats</h2>
                                        <div class="d-flex align-items-center">
                                            <select class="form-select me-1" t-model="state.selectedSupplierId">
                                                <option value="0">Select Supplier</option>
                                                <t t-foreach="state.suppliers" t-as="supplier" t-key="supplier.id">
                                                    <option t-att-value="supplier.id" t-esc="supplier.name"/>
                                                </t>
                                            </select>
                                            <select class="form-select" t-model="state.selectedPeriod">
                                                <option value="0" selected="">All Time</option>
                                                <t t-foreach="timeperiods" t-as="period" t-key="period.tag">
                                                    <option t-att-value="period.tag" t-esc="period.label"/>
                                                </t>
                                            </select>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" t-if="state.selectedSupplierId !== '0'">
                            <StatCard title="'Accepted'" value="state.rfp.accepted"/>
                            <StatCard title="'Submissions'" value="state.rfp.submitted"/>
                            <StatCard title="'Total Amount'" value="state.rfp.total_amount"/>
                        </div>
                        <div class="row" t-if="state.productLineIds.length > 0">
                            <div class="col m-0 p-0">
                                <div class="border m-2 px-4 py-2 bg-white rounded shadow-sm">
                                    <h2 class="text-primary fw-bold">Products</h2>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Product</th>
                                                    <th>RFP Ref</th>
                                                    <th>Quantity</th>
                                                    <th>Unit Price</th>
                                                    <th>Delivery Charge</th>
                                                    <th>Sub Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="state.productLines" t-as="line" t-key="line.id">
                                                    <tr>
                                                        <td>
                                                            <img t-att-src="'data:image/png;base64,' + line.product_image" alt="product" class="img-fluid me-2" width="50"/>
                                                            <span t-esc="line.product_name"/>
                                                        </td>
                                                        <td class="text-muted" t-esc="line.rfp_id[1]"/>
                                                        <td t-esc="line.product_qty"/>
                                                        <td t-esc="line.unit_price"/>
                                                        <td t-esc="line.delivery_charge"/>
                                                        <td t-esc="line.subtotal_price"/>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <t t-if="state.selectedSupplierId !== '0'">
                            <div t-if="state.rfqStatusChartData" class="bg-white border m-2 p-4 rounded shadow-sm">
                                <Graph title="'RFQ Status'" type="'doughnut'" data="state.rfqStatusChartData"/>
                            </div>
                            <div t-if="state.rfpPurchaseChartData" class="bg-white border m-2 p-4 rounded shadow-sm">
                                <Graph title="'Purchase Breakdown'" type="'line'" data="state.rfpPurchaseChartData"/>
                            </div>
                        </t>
                    </div>
                    <div class="col-md-12" t-if="state.selectedSupplierId === '0'">
                        <div class="d-flex flex-column justify-content-center align-items-center my-5 p-5">
                            <img src="/supplies/static/img/dudes-selective-doodle.svg" alt="Empty" class="img-fluid" width="400"/>
                            <h2 class="text-muted">Select a supplier to view stats</h2>
                        </div>
                    </div>
                </div>
            </div>
        </Layout>
    </t>
</templates>